---
import BlogPost from '../layouts/BlogPost.astro';
import Counter from '../components/Counter.astro';
import { postSchema, type Post } from '../schemas/linkSchema';

export async function getStaticPaths() {
  const postsRaw = await Astro.glob('./../content/posts/*.{md,mdx}');
  const posts: Post[] = postsRaw.map((item) => postSchema.parse({
    title: item.frontmatter.title,
    description: item.frontmatter.description,
    heroImage: item.frontmatter.heroImage,
    pubDate: item.frontmatter.pubDate,
    body: item.frontmatter.body,
  }));
  return postsRaw.map((post) => ({
    params: {
      slug: post.file.split('/').pop().replace(/\.md(x)?/, '')
    },
    props: { post },
  }));
}

const { frontmatter, Content } = Astro.props.post

---
<BlogPost {frontmatter}>
  <Content components={{ Counter }} />
</BlogPost>
